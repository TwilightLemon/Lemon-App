<Page x:Class="LemonApp.Views.Pages.LocalPlaylistPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:base="clr-namespace:LemonApp.Common.UIBases;assembly=LemonApp.Common"
      xmlns:common="clr-namespace:LemonApp.Common;assembly=LemonApp.Common"
      xmlns:component="clr-namespace:LemonApp.Components"
      xmlns:converter="clr-namespace:LemonApp.Converters"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="clr-namespace:LemonApp.Views.Pages"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:uc="clr-namespace:LemonApp.Views.UserControls"
      xmlns:vm="clr-namespace:LemonApp.ViewModels"
      xmlns:ws="https://schemas.elecho.dev/wpfsuite"
      Title="PlaylistPage"
      d:DataContext="{d:DesignInstance Type=vm:PlaylistPageViewModel}"
      d:DesignHeight="450"
      d:DesignWidth="800"
      Foreground="{DynamicResource ForeColor}"
      mc:Ignorable="d">
    <Grid>
        <Border x:Name="InfoView"
                Height="120"
                Margin="8"
                Padding="12"
                VerticalAlignment="Top"
                Background="{DynamicResource TabMaskColor}"
                BorderBrush="{DynamicResource BorderColor}"
                BorderThickness="1"
                CornerRadius="8">
            <Grid>
                <TextBlock Margin="10,0,0,0"
                           VerticalAlignment="Top"
                           d:Text="Twlm's Music World"
                           FontSize="32"
                           FontWeight="Bold"
                           Text="{Binding ListName}"
                           TextWrapping="NoWrap"
                           ToolTip="{Binding Description}" />
                <Grid Margin="10,0,0,0" VerticalAlignment="Bottom">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="1*" />
                    </Grid.ColumnDefinitions>
                    <ws:TextBox x:Name="ListSearchBox"
                                Grid.Column="1"
                                Height="30"
                                Margin="8,2"
                                Padding="8,6"
                                Placeholder="Search"
                                Style="{StaticResource SimpleTextBoxStyleForWs}"
                                TextChanged="ListSearchBox_TextChanged" />
                    <ws:WrapPanel x:Name="FuncView"
                                  Height="36"
                                  HorizontalAlignment="Left"
                                  VerticalAlignment="Bottom"
                                  HorizontalSpacing="16"
                                  ItemHeight="36">
                        <ws:Button Padding="16,0"
                                   Command="{Binding PlayAllCommand}"
                                   Style="{StaticResource AccentButtonStyleForWs}">
                            <TextBlock><Run BaselineAlignment="Center"
                                     FontFamily="{StaticResource SegoeFluentIcon}"
                                     FontSize="16"
                                     Text="&#xE768;" /><Run Text=" " /><Run Text=" Play All" /></TextBlock>
                        </ws:Button>
                        <!--  complete later  -->
                        <!--<ws:Button Width="36"
                                   Command="{x:Static component:PublicPopupMenuHolder.AddToQuickAccessCommand}"
                                   CommandParameter="{Binding QuickAccessData}"
                                   Content="&#xE710;"
                                   FontFamily="{StaticResource SegoeFluentIcon}"
                                   FontSize="14"
                                   Style="{StaticResource SimpleButtonStyleForWs}"
                                   ToolTip="Add to Quick Access" />-->
                        <ws:Button Width="36"
                                   Click="OpenDirectoryBtn_Click"
                                   Content="&#xE72D;"
                                   FontFamily="{StaticResource SegoeFluentIcon}"
                                   FontSize="14"
                                   Style="{StaticResource SimpleButtonStyleForWs}"
                                   ToolTip="Open directory" />
                        <TextBlock Padding="6,0"
                                   HorizontalAlignment="Left"
                                   VerticalAlignment="Center">
                            <Run d:Text="520" Text="{Binding Musics.Count, Mode=OneWay}" />
                            <Run Text=" Songs" />
                        </TextBlock>
                    </ws:WrapPanel>
                </Grid>
            </Grid>
        </Border>
        <ws:ListBox x:Name="listBox"
                    Margin="0,134,0,0"
                    d:ItemsSource="{d:SampleData ItemCount=5}"
                    ItemContainerStyle="{DynamicResource SimpleListBoxItemStyle}"
                    ItemsSource="{Binding Musics}"
                    Style="{DynamicResource SimpleListBoxStyle}">
            <ws:ListBox.ItemTemplate>
                <DataTemplate>
                    <Border x:Name="_border"
                            MinHeight="48"
                            base:DoubleClickCommand.Command="{Binding DataContext.PlayMusicCommand, RelativeSource={RelativeSource AncestorType=ws:ListBox}}"
                            base:DoubleClickCommand.CommandParameter="{Binding}"
                            Background="Transparent"
                            CornerRadius="8">
                        <Grid>
                            <ws:ConditionalControl x:Name="Highlighter"
                                                   Width="4"
                                                   Height="22"
                                                   HorizontalAlignment="Left"
                                                   d:Condition="True">
                                <Border Background="{DynamicResource HighlightThemeColor}" CornerRadius="2" />
                            </ws:ConditionalControl>
                            <TextBlock Margin="10,0,0,0"
                                       HorizontalAlignment="Left"
                                       VerticalAlignment="Center"
                                       d:Text="1"
                                       FontSize="12"
                                       Opacity="0.6">
                                <TextBlock.Text>
                                    <MultiBinding Converter="{x:Static converter:IndexOfConverter.Instance}">
                                        <Binding />
                                        <Binding ElementName="listBox" Path="ItemsSource" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                            <TextBlock Margin="32,0,0,0"
                                       VerticalAlignment="Center"
                                       Text="{Binding MusicName}" />
                        </Grid>
                    </Border>
                    <DataTemplate.Triggers>
                        <DataTrigger Value="True">
                            <DataTrigger.Binding>
                                <MultiBinding Converter="{x:Static converter:MusicEqualConverter.Instance}">
                                    <Binding />
                                    <Binding Path="DataContext.Playing" RelativeSource="{RelativeSource AncestorType={x:Type ws:ListBox}}" />
                                </MultiBinding>
                            </DataTrigger.Binding>
                            <Setter Property="TextElement.Foreground" Value="{DynamicResource HighlightThemeColor}" />
                            <Setter Property="TextElement.FontWeight" Value="Bold" />
                            <Setter TargetName="Highlighter" Property="Condition" Value="True" />
                            <!--<Setter TargetName="_border"
                                        Property="Background"
                                        Value="{DynamicResource MaskColor}" />-->
                        </DataTrigger>
                    </DataTemplate.Triggers>
                </DataTemplate>
            </ws:ListBox.ItemTemplate>
        </ws:ListBox>

        <ws:Button x:Name="GotoPlayingBtn"
                   Width="36"
                   Height="36"
                   Margin="32"
                   HorizontalAlignment="Right"
                   VerticalAlignment="Bottom"
                   Click="GotoPlayingBtn_Click"
                   CornerRadius="18"
                   Style="{StaticResource AccentButtonStyleForWs}"
                   Visibility="{Binding ShowGotoPlaying}">
            <Path Width="16"
                  Data="{StaticResource Icon_Position}"
                  Fill="{DynamicResource BackgroundColor}"
                  Stretch="Uniform" />
        </ws:Button>
    </Grid>
</Page>
